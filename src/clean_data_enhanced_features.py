"""
clean_data_enhanced_features.py
ê°•í™”ëœ í”¼ì²˜ ì¶”ê°€ ë²„ì „
"""

import pandas as pd
import numpy as np
from datetime import datetime

print("=" * 80)
print("ğŸ“Š ë°ì´í„° ì „ì²˜ë¦¬ ì‹œì‘ (ê°•í™”ëœ í”¼ì²˜ ì¶”ê°€)")
print("=" * 80)

# 1. ì—­ ì¹´í…Œê³ ë¦¬ ì •ì˜ (í™•ì¥)
print("\n1. ì—­ ì¹´í…Œê³ ë¦¬ ë§¤í•‘ ìƒì„± ì¤‘...")

STATION_CATEGORIES = {
    # ì´ˆëŒ€í˜• ì—…ë¬´ + ìƒì—… ì§€êµ¬
    'ê°•ë‚¨': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ì—­ì‚¼': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ì„ ë¦‰': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 1, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ì‚¼ì„±': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ì—¬ì˜ë„': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ê´‘í™”ë¬¸': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ì¢…ê°': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 1, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    'ì„ì§€ë¡œì…êµ¬': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 1, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    
    # ìƒì—…/ì‡¼í•‘ ì§€êµ¬
    'í™ëŒ€ì…êµ¬': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 1, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 2},
    'ì‹ ì´Œ': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 1, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 2},
    'ëª…ë™': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 2},
    'ë™ëŒ€ë¬¸': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 2},
    
    # ëŒ€í•™ê°€
    'ì‹ ë¦¼': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 1, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 3},
    'ì„œìš¸ëŒ€ì…êµ¬': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 1, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 3},
    'ì´ëŒ€': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 1, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 3},
    'ê±´ëŒ€ì…êµ¬': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 1, 'ëŒ€í•™ê°€': 1, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 3},
    
    # ì´ˆëŒ€í˜• í™˜ìŠ¹ì—­ (í•µì‹¬!)
    'ì™•ì‹­ë¦¬': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 4, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 4},
    'ì‹ ë„ë¦¼': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 3, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 4},
    'ì‚¬ë‹¹': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 3, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 4},
    'ì ì‹¤': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 4},
    'êµëŒ€': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 4},
    'ê³ ì†í„°ë¯¸ë„': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 1, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 3, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 4},
    
    # ì£¼ê±° ì§€ì—­
    'ëª©ë™': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 5},
    'ë…¸ì›': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 2, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 5},
    'ìˆ˜ìœ ': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 5},
    'êµ¬ë¡œë””ì§€í„¸ë‹¨ì§€': {'ì—…ë¬´ì§€êµ¬': 1, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 1, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 1},
    
    # ì™¸ê³½ ì§€ì—­
    'ê¹Œì¹˜ì‚°': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 6},
    'ì‹ ì •ë„¤ê±°ë¦¬': {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 1, 'ì—­_ê·¸ë£¹': 6},
}

DEFAULT_CATEGORY = {'ì—…ë¬´ì§€êµ¬': 0, 'ìƒì—…ì§€êµ¬': 0, 'í™˜ìŠ¹ì—­ë“±ê¸‰': 0, 'ëŒ€í•™ê°€': 0, 'ì£¼ê±°ì§€ì—­': 0, 'ì—­_ê·¸ë£¹': 0}

print(f"   ì •ì˜ëœ ì—­ ìˆ˜: {len(STATION_CATEGORIES)}ê°œ")

# 2. ë°ì´í„° ë¡œë“œ
print("\n2. ë°ì´í„° ë¡œë“œ ì¤‘...")
df = pd.read_csv('data/processed/subway_features_balanced.csv', encoding='utf-8-sig')
print(f"   ë¡œë“œ ì™„ë£Œ: {len(df):,}ê°œ ë ˆì½”ë“œ")

# 3. ê¸°ì¡´ ì—­ ì¹´í…Œê³ ë¦¬ í”¼ì²˜ ì¶”ê°€
print(f"\n3. ê¸°ë³¸ ì—­ ì¹´í…Œê³ ë¦¬ í”¼ì²˜ ìƒì„± ì¤‘...")

df['ì—­_ì—…ë¬´ì§€êµ¬'] = df['ì§€í•˜ì² ì—­'].apply(lambda x: STATION_CATEGORIES.get(x, DEFAULT_CATEGORY)['ì—…ë¬´ì§€êµ¬'])
df['ì—­_ìƒì—…ì§€êµ¬'] = df['ì§€í•˜ì² ì—­'].apply(lambda x: STATION_CATEGORIES.get(x, DEFAULT_CATEGORY)['ìƒì—…ì§€êµ¬'])
df['ì—­_í™˜ìŠ¹ì—­ë“±ê¸‰'] = df['ì§€í•˜ì² ì—­'].apply(lambda x: STATION_CATEGORIES.get(x, DEFAULT_CATEGORY)['í™˜ìŠ¹ì—­ë“±ê¸‰'])
df['ì—­_ëŒ€í•™ê°€'] = df['ì§€í•˜ì² ì—­'].apply(lambda x: STATION_CATEGORIES.get(x, DEFAULT_CATEGORY)['ëŒ€í•™ê°€'])
df['ì—­_ì£¼ê±°ì§€ì—­'] = df['ì§€í•˜ì² ì—­'].apply(lambda x: STATION_CATEGORIES.get(x, DEFAULT_CATEGORY)['ì£¼ê±°ì§€ì—­'])
df['ì—­_ê·¸ë£¹'] = df['ì§€í•˜ì² ì—­'].apply(lambda x: STATION_CATEGORIES.get(x, DEFAULT_CATEGORY)['ì—­_ê·¸ë£¹'])

print(f"   âœ… ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ 6ê°œ ìƒì„±")

# 4. ğŸ¯ ê°•í™”ëœ ì‹œê°„ í”¼ì²˜
print(f"\n4. ê°•í™”ëœ ì‹œê°„ í”¼ì²˜ ìƒì„± ì¤‘...")

# 4-1. ì¶œí‡´ê·¼ ì‹œê°„ëŒ€ ëª…ì‹œì  í‘œì‹œ
df['ì¶œê·¼ì‹œê°„ëŒ€'] = ((df['ì‹œê°„'] >= 7) & (df['ì‹œê°„'] <= 9)).astype(int)
df['í‡´ê·¼ì‹œê°„ëŒ€'] = ((df['ì‹œê°„'] >= 18) & (df['ì‹œê°„'] <= 20)).astype(int)
df['ì ì‹¬ì‹œê°„ëŒ€'] = ((df['ì‹œê°„'] >= 12) & (df['ì‹œê°„'] <= 13)).astype(int)
df['ì‹¬ì•¼ì‹œê°„ëŒ€'] = ((df['ì‹œê°„'] >= 0) & (df['ì‹œê°„'] <= 5)).astype(int)
df['ì €ë…ì‹œê°„ëŒ€'] = ((df['ì‹œê°„'] >= 21) & (df['ì‹œê°„'] <= 23)).astype(int)

print(f"   âœ… ì‹œê°„ëŒ€ êµ¬ë¶„ 5ê°œ ìƒì„±")

# 4-2. ëŸ¬ì‹œì•„ì›Œ ê°•ë„ (ì¶œí‡´ê·¼ ì‹œê°„ì¼ìˆ˜ë¡ ë†’ì€ ê°’)
def get_rush_hour_intensity(hour):
    if hour == 8:
        return 1.0  # ìµœëŒ€ ì¶œê·¼ ì‹œê°„
    elif hour in [7, 9]:
        return 0.7
    elif hour == 18 or hour == 19:
        return 0.9  # í‡´ê·¼ í”¼í¬
    elif hour == 20:
        return 0.6
    else:
        return 0.0

df['ëŸ¬ì‹œì•„ì›Œê°•ë„'] = df['ì‹œê°„'].apply(get_rush_hour_intensity)
print(f"   âœ… ëŸ¬ì‹œì•„ì›Œ ê°•ë„ ìƒì„±")

# 5. ğŸ¯ ê°•í™”ëœ ìƒí˜¸ì‘ìš© í”¼ì²˜
print(f"\n5. ê°•í™”ëœ ìƒí˜¸ì‘ìš© í”¼ì²˜ ìƒì„± ì¤‘...")

# ê¸°ì¡´ ìƒí˜¸ì‘ìš©
if 'ì‹œê°„ëŒ€êµ¬ë¶„_encoded' in df.columns and 'ìš”ì¼' in df.columns:
    df['time_dow_interaction'] = df['ì‹œê°„ëŒ€êµ¬ë¶„_encoded'] * 10 + df['ìš”ì¼']
    print(f"   âœ… ì‹œê°„ëŒ€Ã—ìš”ì¼")

if 'ì§€í•˜ì² ì—­_encoded' in df.columns and 'ì‹œê°„ëŒ€êµ¬ë¶„_encoded' in df.columns:
    df['station_time_interaction'] = df['ì§€í•˜ì² ì—­_encoded'] * 10 + df['ì‹œê°„ëŒ€êµ¬ë¶„_encoded']
    print(f"   âœ… ì—­Ã—ì‹œê°„ëŒ€")

# ìƒˆë¡œìš´ ê°•í™” ìƒí˜¸ì‘ìš©
df['business_rush_interaction'] = df['ì—­_ì—…ë¬´ì§€êµ¬'] * df['ëŸ¬ì‹œì•„ì›Œê°•ë„'] * 10
df['transfer_rush_interaction'] = df['ì—­_í™˜ìŠ¹ì—­ë“±ê¸‰'] * df['ëŸ¬ì‹œì•„ì›Œê°•ë„'] * 10
df['university_morning_interaction'] = df['ì—­_ëŒ€í•™ê°€'] * df['ì¶œê·¼ì‹œê°„ëŒ€']

print(f"   âœ… ì—…ë¬´ì§€êµ¬Ã—ëŸ¬ì‹œì•„ì›Œ, í™˜ìŠ¹ì—­Ã—ëŸ¬ì‹œì•„ì›Œ, ëŒ€í•™ê°€Ã—ì•„ì¹¨")

# í‰ì¼/ì£¼ë§ Ã— ì—­ ì¹´í…Œê³ ë¦¬
df['business_weekday'] = df['ì—­_ì—…ë¬´ì§€êµ¬'] * (1 - df['ì£¼ë§ì—¬ë¶€'])
df['commercial_weekend'] = df['ì—­_ìƒì—…ì§€êµ¬'] * df['ì£¼ë§ì—¬ë¶€']

print(f"   âœ… ì—…ë¬´ì§€êµ¬Ã—í‰ì¼, ìƒì—…ì§€êµ¬Ã—ì£¼ë§")

# 6. ğŸ¯ ë³µí•© í”¼ì²˜ (3-way interaction)
print(f"\n6. 3-way ìƒí˜¸ì‘ìš© í”¼ì²˜ ìƒì„± ì¤‘...")

# ì—­ê·¸ë£¹ Ã— ì‹œê°„ëŒ€ Ã— ìš”ì¼
if 'ì‹œê°„ëŒ€êµ¬ë¶„_encoded' in df.columns:
    df['group_time_dow'] = (df['ì—­_ê·¸ë£¹'] * 100 + 
                             df['ì‹œê°„ëŒ€êµ¬ë¶„_encoded'] * 10 + 
                             df['ìš”ì¼'])
    print(f"   âœ… ì—­ê·¸ë£¹Ã—ì‹œê°„ëŒ€Ã—ìš”ì¼")

# í™˜ìŠ¹ì—­ Ã— ì¶œê·¼ì‹œê°„ Ã— í‰ì¼
df['transfer_rush_weekday'] = (df['ì—­_í™˜ìŠ¹ì—­ë“±ê¸‰'] * 
                                 df['ì¶œê·¼ì‹œê°„ëŒ€'] * 
                                 (1 - df['ì£¼ë§ì—¬ë¶€']))
print(f"   âœ… í™˜ìŠ¹ì—­Ã—ì¶œê·¼Ã—í‰ì¼")

# 7. íƒ€ê²Ÿ ê´€ë ¨ í”¼ì²˜ ì œê±°
print(f"\n7. íƒ€ê²Ÿ ê´€ë ¨ í”¼ì²˜ ì œê±° ì¤‘...")
TARGET_RELATED_FEATURES = [
    'ìŠ¹ì°¨ì¸ì›', 'í•˜ì°¨ì¸ì›', 'ì´ìŠ¹í•˜ì°¨ì¸ì›',
    'ì—­_í‰ê· ìŠ¹í•˜ì°¨', 'ì‹œê°„_í‰ê· ìŠ¹í•˜ì°¨',
    'ìŠ¹í•˜ì°¨_3ì¼í‰ê· ', 'ìŠ¹í•˜ì°¨_7ì¼í‰ê· ',
    'ìŠ¹í•˜ì°¨_14ì¼í‰ê· ', 'ìŠ¹í•˜ì°¨_30ì¼í‰ê· ',
    'í˜¼ì¡ë„', 'ìƒëŒ€ì í˜¼ì¡ë„',
    'ì—­_ìµœëŒ€ìŠ¹í•˜ì°¨', 'ì—­_ìµœì†ŒìŠ¹í•˜ì°¨',
    'ì‹œê°„_ìµœëŒ€ìŠ¹í•˜ì°¨', 'ì‹œê°„_ìµœì†ŒìŠ¹í•˜ì°¨'
]

removed_features = []
for feature in TARGET_RELATED_FEATURES:
    if feature in df.columns:
        df = df.drop(columns=[feature])
        removed_features.append(feature)

print(f"   ì œê±°ëœ í”¼ì²˜: {len(removed_features)}ê°œ")

# 8. ìµœì¢… í”¼ì²˜ ì„ íƒ
print(f"\n8. ìµœì¢… í”¼ì²˜ ì„ íƒ ì¤‘...")

TARGET = 'í˜¼ì¡ë„ë ˆë²¨'
EXCLUDE_COLUMNS = [TARGET, 'ì‚¬ìš©ì¼ì', 'Unnamed: 0', 'ì§€í•˜ì² ì—­', 'í˜¸ì„ ëª…']

feature_columns = [col for col in df.columns if col not in EXCLUDE_COLUMNS]
print(f"   ì´ í”¼ì²˜ ìˆ˜: {len(feature_columns)}ê°œ")

# ìƒˆë¡œ ì¶”ê°€ëœ í”¼ì²˜ í™•ì¸
new_features = [col for col in feature_columns if any(x in col for x in 
               ['ì—­_', 'interaction', 'ì‹œê°„ëŒ€', 'ê°•ë„', 'rush', 'weekday', 'weekend'])]
print(f"\n   ğŸ¯ ìƒˆë¡œ ì¶”ê°€/ìˆ˜ì •ëœ í”¼ì²˜ ({len(new_features)}ê°œ):")
for feat in sorted(set(new_features)):
    if feat in df.columns:
        non_zero = (df[feat] != 0).sum()
        print(f"      - {feat}: ë¹„ì œë¡œ {non_zero:,}ê°œ")

# 9. ë°ì´í„° í’ˆì§ˆ ì²˜ë¦¬
print(f"\n9. ë°ì´í„° í’ˆì§ˆ í™•ì¸...")
df[feature_columns] = df[feature_columns].fillna(0)

for col in feature_columns:
    if df[col].dtype in ['float64', 'int64']:
        inf_count = np.isinf(df[col]).sum()
        if inf_count > 0:
            df[col] = df[col].replace([np.inf, -np.inf], 0)

# 10. ë°ì´í„° ì €ì¥
print(f"\n10. ë°ì´í„° ì €ì¥ ì¤‘...")
output_path = 'data/processed/subway_features_enhanced.csv'
df.to_csv(output_path, index=False, encoding='utf-8-sig')
print(f"   âœ… ì €ì¥ ì™„ë£Œ: {output_path}")

# 11. ìµœì¢… í†µê³„
print(f"\n" + "=" * 80)
print(f"âœ… ì „ì²˜ë¦¬ ì™„ë£Œ!")
print(f"=" * 80)
print(f"ğŸ“Š ìµœì¢… ë°ì´í„°ì…‹:")
print(f"   - ì „ì²´ ë ˆì½”ë“œ: {len(df):,}ê°œ")
print(f"   - í”¼ì²˜ ìˆ˜: {len(feature_columns)}ê°œ")
print(f"   - íƒ€ê²Ÿ: {TARGET}")

print(f"\nì£¼ìš” í†µê³„:")
print(f"   - ì¶œê·¼ì‹œê°„ëŒ€ ë ˆì½”ë“œ: {df['ì¶œê·¼ì‹œê°„ëŒ€'].sum():,}ê°œ")
print(f"   - í‡´ê·¼ì‹œê°„ëŒ€ ë ˆì½”ë“œ: {df['í‡´ê·¼ì‹œê°„ëŒ€'].sum():,}ê°œ")
print(f"   - í™˜ìŠ¹ì—­(2ê°œâ†‘) ë ˆì½”ë“œ: {(df['ì—­_í™˜ìŠ¹ì—­ë“±ê¸‰'] >= 2).sum():,}ê°œ")
print(f"   - ì—…ë¬´ì§€êµ¬ ë ˆì½”ë“œ: {(df['ì—­_ì—…ë¬´ì§€êµ¬'] == 1).sum():,}ê°œ")

# ì™•ì‹­ë¦¬ íŠ¹ë³„ í™•ì¸
wangsimni = df[df['ì§€í•˜ì² ì—­'] == 'ì™•ì‹­ë¦¬']
if len(wangsimni) > 0:
    print(f"\nğŸ¯ ì™•ì‹­ë¦¬ ë°ì´í„° í™•ì¸:")
    print(f"   - ì´ ë ˆì½”ë“œ: {len(wangsimni):,}ê°œ")
    print(f"   - í™˜ìŠ¹ì—­ë“±ê¸‰: {wangsimni['ì—­_í™˜ìŠ¹ì—­ë“±ê¸‰'].iloc[0]}")
    print(f"   - ì—­ê·¸ë£¹: {wangsimni['ì—­_ê·¸ë£¹'].iloc[0]}")
    print(f"   - í˜¼ì¡ë„ ë¶„í¬:")
    for level, count in wangsimni['í˜¼ì¡ë„ë ˆë²¨'].value_counts().sort_index().items():
        print(f"      ë ˆë²¨ {level}: {count:,}ê°œ")

print(f"\në‹¤ìŒ ë‹¨ê³„: python model_trainer_enhanced.py")
print("=" * 80)
